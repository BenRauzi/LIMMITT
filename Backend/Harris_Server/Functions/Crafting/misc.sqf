Harris_craftAbleItems =   
	[
		["AK-74 Assault Rifle","hlc_rifle_ak74_dirty", "", [["Harris_steelIngot",11, "Coal Ore"]], "Rifles", 1.5, false],
		["30rnd 5.45x39 Subsonic Magazine","hlc_30Rnd_545x39_S_AK", "", [["Harris_steelIngot",2, "Coal Ore"]], "Rifles", 0.2, true],

		["AK-47 Assault Rifle","hlc_rifle_ak47", "bp_ak", [["Harris_steelIngot",11, "Steel Ingot"],["RR_woodLog",3, "Wood"]], "Rifles", 1.7, false], 
		["30rnd 7.62x39 Subsonic Magazine","hlc_30rnd_762x39_s_ak", "", [["Harris_steelIngot",2, "Steel Ingot"]], "Rifles", 0.2, true],

		["RPK Machine Gun","hlc_rifle_rpk", "bp_rpk", [["Harris_steelIngot",18, "Steel Ingot"],["RR_woodLog",4, "Wood"]], "Rifles", 2.5, false], 
		["45rnd 7.62x39 Magazine","hlc_45Rnd_762x39_m_rpk", "bp_rpk", [["Harris_steelIngot",4, "Steel Ingot"]], "Rifles", 0.2, true], 

		["M21 Marksman Rifle","hlc_rifle_M21", "bp_m21", [["Harris_steelIngot",19, "Steel Ingot"],["RR_woodLog",2, "Wood"]], "Rifles", 2.7, false], 
		["20rnd 7.62x51 Ball Magazine - M21","hlc_20Rnd_762x51_B_M14", "bp_m21", [["Harris_steelIngot",3, "Steel Ingot"]], "Rifles", 0.2, true], 

		["FN FAL Rifle","hlc_rifle_LAR", "bp_fal", [["Harris_steelIngot",20, "Steel Ingot"],["RR_woodLog",3, "Wood"]], "Rifles", 2.6, false], 
		["20rnd 7.62x51 Ball Magazine - FN FAL","hlc_20Rnd_762x51_B_fal", "bp_fal", [["Harris_steelIngot",3, "Steel Ingot"]], "Rifles", 0.2, true], 

		["RPG-7","launch_RPG7_F", "bp_rpg7", [["Harris_steelIngot",30, "Steel Ingot"],["RR_woodLog",10, "Wood"]], "Rifles", 3.5, false],
		["RPG-7 HEAT Grenade","RPG7_F", "bp_rpg7", [["Harris_steelIngot",15, "Steel Ingot"]], "Rifles", 1, true],

		["Beretta M9","RH_m9", "", [["Harris_steelIngot",4, "Steel Ingot"]], "Pistols", 0.3, false],
		["15Rnd 9x19 M9","RH_15Rnd_9x19_M9", "", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["Colt Python","RH_python", "bp_pyth", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.4, false], 
		["6Rnd .357 Mag","RH_6Rnd_357_Mag", "bp_pyth", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.1, true], 

		["Colt M1911","sab_1911_handgun", "", [["Harris_steelIngot",5, "Steel Ingot"]], "Pistols", 0.4, false],
		["9Rnd .45ACP Mag","9Rnd_45ACP_Mag", "", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.1, true],

		["CZ 75","RH_cz75", "", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.4, false],
		["16Rnd 9x19 CZ","RH_16Rnd_9x19_CZ", "", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.1, true],

		["Magnum Desert Eagle","RH_deagle", "bp_deag", [["Harris_steelIngot",7, "Steel Ingot"]], "Pistols", 0.6, false], 
		["Magnum Desert Eagle - Modern","RH_deaglem", "bp_deag", [["Harris_steelIngot",7, "Steel Ingot"]], "Pistols", 0.6, false], 
		["Magnum Desert Eagle - Silver","RH_deagles", "bp_deag", [["Harris_steelIngot",7, "Steel Ingot"]], "Pistols", 0.6, false], 
		["7Rnd .50 AE","RH_7Rnd_50_AE", "bp_deag", [["Harris_steelIngot",3, "Steel Ingot"]], "Pistols", 0.1, true],
		
		["FN Five-Seven","RH_fn57", "bp_57", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.5, false], 
		["20Rnd 57x28 FN","RH_20Rnd_57x28_FN", "bp_57", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["FN FNP-45","RH_fnp45", "", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.4, false],
		["FN FNP-45 - Tan","RH_fnp45t", "", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.4, false],
		["15Rnd 45cal FNP","RH_15Rnd_45cal_fnp", "", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["Glock 17","RH_g17", "", [["Harris_steelIngot",5, "Steel Ingot"]], "Pistols", 0.3, false],
		["Glock 19","RH_g19", "", [["Harris_steelIngot",5, "Steel Ingot"]], "Pistols", 0.3, false],
		["7Rnd 9x19 Glock ammo","RH_17Rnd_9x19_g17", "", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["GSH-18","RH_gsh18", "", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.4, false],
		["18Rnd 9x19 GSH","RH_18Rnd_9x19_gsh", "", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["Heckler & Koch MP5K","hlc_smg_mp5k", "bp_mp5k", [["Harris_steelIngot",9, "Steel Ingot"]], "Pistols", 0.9, false], 
		["30Rnd 9x19 Ball MP5","hlc_30Rnd_9x19_B_MP5", "bp_mp5k", [["Harris_steelIngot",3, "Steel Ingot"]], "Pistols", 0.1, true],

		["Intratec Tec-9","RH_tec9", "", [["Harris_steelIngot",8, "Steel Ingot"]], "Pistols", 0.7, false],
		["32Rnd 9x19 TEC","RH_32Rnd_9x19_tec", "", [["Harris_steelIngot",3, "Steel Ingot"]], "Pistols", 0.1, true],

		["Kimber Night Warrior","RH_kimber_nw", "", [["Harris_steelIngot",6, "Steel Ingot"]], "Pistols", 0.5, false],
		["7Rnd 45cal M1911","RH_7Rnd_45cal_m1911", "", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["Micro UZI","RH_muzi", "bp_uzi", [["Harris_steelIngot",8, "Steel Ingot"]], "Pistols", 0.6, false], 
		["30Rnd 9x19 UZI","RH_30Rnd_9x19_UZI", "bp_uzi", [["Harris_steelIngot",3, "Steel Ingot"]], "Pistols", 0.1, true],

		["VZ 61 Scorpion","RH_vz61", "bp_vz61", [["Harris_steelIngot",6, "Steel Ingot"],["RR_woodLog",1, "Wood"]], "Pistols", 0.5, false], 
		["20Rnd 32cal vz61","RH_20Rnd_32cal_vz61", "bp_vz61", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["Ruger MK2 - Silenced","RH_mk2", "bp_mk2", [["Harris_steelIngot",7, "Steel Ingot"]], "Pistols", 0.4, false], 
		["10Rnd 22LR MK2","RH_10Rnd_22LR_mk2", "bp_mk2", [["Harris_steelIngot",2, "Steel Ingot"]], "Pistols", 0.1, true],

		["Heckler & Koch USP Match","RH_uspm", "", [["Harris_steelIngot",7, "Steel Ingot"]], "Pistols", 0.4, false],
		["16Rnd 40cal USP","RH_16Rnd_40cal_usp", "", [["Harris_steelIngot",3, "Steel Ingot"]], "Pistols", 0.1, true],


		//["C4 Explosive","RR_c4", "", [["RR_RDX",4, "RDX Compound"],["Harris_steelIngot",6, "Steel Ingot"]], "Items", 2, false],
		//["Lockpicks","RR_lockpicks", "", [["RR_IronIngot",4, "Iron Ingot"]], "Items", 0.5, false]

	];

	Harris_smeltAbleItems =   
	[
		["Refined Coal","Harris_coal", "", [["Harris_CoalOre",2, "Coal Ore"]], "Refine", 0.1, true],
		["Iron Ingot","Harris_ironIngot", "", [["Harris_ironOre",2, "Iron Ore"]], "Refine", 0.1, true],
		["Steel Ingot","Harris_ironIngot", "", [["Harris_ironOre",2, "Iron Ore"],["Harris_coalOre",4, "Coal Ore"]], "Refine", 0.2, true],
		["Gold Bar","Harris_goldIngot", "", [["Harris_goldOre",2, "Gold Ore"]], "Refine", 0.3, true]
	]; // Add Timber from Logs and Diamonds
	Harris_smeltTypes = ["Refine"];
	Harris_craftTypes = ["Rifles", "Pistols", "Items"]; //??

	Harris_bluePrints = [
		["bp_uzi", "Uzi"], 
		["bp_ak", "Kalashnikov Rifle"], 
		["bp_vz61", "Scorpian Pistol"], 
		["bp_rpk", "RPK"], 
		["bp_mk2", "MK2"], 
		["bp_m21", "M21 Rifle"], 
		["bp_rpg7", "Rocket-Propelled-Grenade"], 
		["bp_fal", "FN FAL"], 
		["bp_pyth", "Python"],
		["bp_deag", "Desert Eagle"], 
		["bp_57", ".57"], 
		["bp_mp5k", "MPK5"]
	];

	Harris_inProcessing = false;

	Harris_craftSchedule = [];

	player setVariable ["bluePrints", []];

Harris_openCraftTimer = {
	params["_time", "_item", "_itemType","_displayName", "_bool"];
	player forceWalk true;
	19 cutRsc ["Harris_Progress","PLAIN"];
	_progressUI = uiNamespace getVariable ["Harris_Progress",displayNull];
	_progressBar = _progressUI displayCtrl 1400;
	_itemText = _progressUI displayCtrl 1000;
	_progressBar progressSetPosition 0.01;

	Harris_sleepTime = (_time * 60) / 100;
	_progressPosition = 0;

	_itemText ctrlSetText _displayName;
	while {true} do
	{
		_progressPosition = _progressPosition + 0.01;
		_progressBar progressSetPosition _progressPosition;
		sleep Harris_sleepTime;
		Harris_Time = _progressPosition;

		if (animationState player != "ainvpknlmstpsnonwnondnon_medic_1") then {
			player playMove "AinvPknlMstpSnonWnonDnon_medic_1";
		};

		if (_progressPosition >= 1 && count Harris_craftSchedule > 1) exitWith {

			Harris_craftSchedule deleteAt 0;
		
			if (player canAdd _item) then {
				player addItem _item;
			} else {
				_holder = "groundWeaponHolder" createVehicle position player;
				_holder setPos (getpos Player);
				_holder addItemCargoGlobal [_item, 1];
			};

			_item = (Harris_craftSchedule select 0) select 1;
			_time = (Harris_craftSchedule select 0) select 5;
			_itemType = (Harris_craftSchedule select 0) select 4;
			_displayName = (Harris_craftSchedule select 0) select 0;

			[_time, _item, _itemType, _displayName] spawn Harris_openCraftTimer;

			19 cutText ["","PLAIN"];
		};
		if (_progressPosition >= 1) exitWith {
			Harris_craftSchedule deleteAt 0;
			["Success", "Item Crafted", true] spawn Harris_Notifications;
			if (player canAdd _item) then {
				player addItem _item;
			} else {
				_holder = "groundWeaponHolder" createVehicle position player;
				_holder setPos (getpos Player);
				_holder addItemCargoGlobal [_item, 1];
			};
			
			19 cutText ["","PLAIN"];
			player forceWalk false;
		};
	};
};


Harris_addBluePrint = {
	params["_bp"];

	if (isNil "_bp") then {
		_bp = selectRandom Harris_bluePrints;
	};

	player playMove "AinvPknlMstpSnonWnonDnon_medic_1";

	_bluePrints = player getVariable "bluePrints";

	

	closeDialog 0;
	player removeItem "RR_blueprintnotes";

	sleep 3;
	test = _bp select 0;
	test2 = player getVariable "bluePrints";
	if ((_bp select 0) in (player getVariable "bluePrints")) exitWith {
		["Error", "You already know this bluePrint", true] spawn Harris_Notifications;
	};
	_msg = format ["You just researched a %1 blueprint", (_bp select 1)];
	["Success", _msg, true] spawn Harris_Notifications;

	_bluePrints pushBack (_bp select 0);
	player setVariable ["bluePrints", _bluePrints, true];

	profileNamespace setVariable ['bluePrints', _bluePrints, true];
	saveProfileNamespace;
};


Harris_craftItem = {
	if (Harris_inProcessing) exitWith { ["Error", "You cannot smelt and craft at the same time!", true] spawn Harris_Notifications; };
	_data = lbData [1500, ( lbCurSel 1500 )];
	_data = call compile _data;	

	_requiredItems = _data select 3;
	_bool = false;
	_items = items player;
	{
		_itemsLocal = _items;
		_id = _x select 0;
		_count = 0;
			{
				if (_id == _x) then {
					_count = _count + 1;
				};
			} forEach _itemsLocal;

		if (_count < (_x select 1)) exitWith { ["Error","You do not have the required items", true] spawn Harris_Notifications; _bool = true;};

	} forEach _requiredItems;

	if !(_bool) then {
		Harris_Items = _requiredItems;
		{	

			_vars = ["","","","","","","","",""];
			_count = 0;
			_item = _x select 0;
			Harris_itemCount = _x select 1;
			{
				if (_count < Harris_itemCount) then {
					player removeItem _item;
				};
				_count = _count + 1;
			} forEach _vars;
		} forEach _requiredItems;

		Harris_craftSchedule pushBack _data;
		if (count Harris_craftSchedule <= 1) then {
			[_data select 5, _data select 1, _data select 4, _data select 0, _data select 6] spawn Harris_openCraftTimer;
		};
	};
};

Harris_onCraftSelectionLbChanged = {
	_data = lbData [2100, ( lbCurSel 2100 )];

	lbClear 1500;

	if (craftType == 0) then {
		craftAbleItems = Harris_craftAbleItems;
	} else {
		craftAbleItems = Harris_smeltAbleItems;
	};
	craftType = nil;
	_bluePrints = player getVariable "bluePrints";
	{
		_bluePrint = _x select 2;
		_select = _x select 4;

		if (_bluePrint != "" && _bluePrint in _bluePrints && _select == _data) then {
			
			_index = lbAdd [1500, _x select 0];
			lbSetData [1500, _index, str _x];
		} else {
			if (_bluePrint == "" && _select == _data) then {
				_index = lbAdd [1500, _x select 0];
				lbSetData [1500, _index, str _x];
			};
		};
	} forEach craftAbleItems;
	craftAbleItems = nil;
};

Harris_openCraftingMenu = {
	params["_type"];

	if (isNil "_type") then {
		createDialog "Harris_Crafting";
		craftTypes = Harris_craftTypes;
		craftType = 0;
	} else {
		createDialog "Harris_Refine";
		craftTypes = Harris_smeltTypes;
		craftType = 1;
	};

	_bluePrints = player getVariable "bluePrints";

	{
		_index = lbAdd [2100, _x];
		lbSetData [2100, _index, _x];
	} forEach craftTypes;
	craftTypes = nil;

	lbSetCurSel [2100, 0];
};

Harris_onCraftLbChanged = {

	Harris_Data = lbData [1500, ( lbCurSel 1500 )];

	Harris_Data = call compile Harris_Data;

	_neededMaterials = Harris_data select 3;

	_count = false;

	lbClear 1501;
	{
		_toAdd = format ["%1 x%2", _x select 2, _x select 1];
		lbAdd [1501, _toAdd];
	} forEach _neededMaterials;
	
};
[1] call Harris_openCraftingMenu;

// Inventory opened EVH
/*
[] spawn
	{
			waitUntil {!isNull (findDisplay 602)};

			((findDisplay 602) displayCtrl 638) ctrlSetEventHandler ["LBDblClick", "[638 ,_this select 1] call Harris_useItemPhysical;"];  
			((findDisplay 602) displayCtrl 633) ctrlSetEventHandler ["LBDblClick", "[633 ,_this select 1] call Harris_useItemPhysical;"];  
			((findDisplay 602) displayCtrl 640) ctrlSetEventHandler ["LBDblClick", "[640 ,_this select 1] call Harris_useItemPhysical;"];  
			((findDisplay 602) displayCtrl 619) ctrlSetEventHandler ["LBDblClick", "[619 ,_this select 1] call Harris_useItemPhysical;"];
	};
*/

Harris_useItemPhysical = {

	_value = lbText [_this select 0, _this select 1];

	switch (_value) do
	{
		case "Plant Pot":
		{
			//[] spawn HRP_fnc_plantPot;
		};
		case "Crafting Notes":
		{
			[] spawn Harris_addBluePrint;
		};
	};
};